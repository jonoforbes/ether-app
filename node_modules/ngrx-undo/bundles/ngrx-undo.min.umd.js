!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@ngrx/store"),require("@angular/core")):"function"==typeof define&&define.amd?define(["exports","@ngrx/store","@angular/core"],factory):factory(global.ngrx-undo=global.ngrx-undo||{},global.ngrx.store,global.ng.core)}(this,function(exports,_ngrx_store,_angular_core){"use strict";function handleUndo(rootReducer,bufferSize){var executedActions=[],initialState=void 0;return function(state,action){if(action.type===UNDO_ACTION){var newState_1=initialState;return executedActions=executedActions.filter(function(eAct){return eAct!==action.payload}),executedActions.forEach(function(executedAction){return newState_1=rootReducer(newState_1,executedAction)}),newState_1}executedActions.push(action);var updatedState=rootReducer(state,action);if(executedActions.length===bufferSize+1){var firstAction=executedActions[0];initialState=rootReducer(initialState,firstAction),executedActions=executedActions.slice(1,bufferSize+1)}return updatedState}}function createReducer(dispatcher,reducer,options){return new _ngrx_store.Reducer(dispatcher,handleUndo(reducer,options.bufferSize))}var UNDO_DEVTOOLS_CONFIG=new _angular_core.OpaqueToken("@ngrx/undodevtools Options"),UNDO_ACTION="ngrx-undo/UNDO_ACTION",StoreUndoModule=function(){function StoreUndoModule(){}return StoreUndoModule.interceptStore=function(options){return void 0===options&&(options={bufferSize:100}),{ngModule:StoreUndoModule,providers:[{provide:UNDO_DEVTOOLS_CONFIG,useValue:options},{provide:_ngrx_store.Reducer,deps:[_ngrx_store.Dispatcher,_ngrx_store.INITIAL_REDUCER,UNDO_DEVTOOLS_CONFIG],useFactory:createReducer}]}},StoreUndoModule.decorators=[{type:_angular_core.NgModule,args:[{imports:[_ngrx_store.StoreModule]}]}],StoreUndoModule.ctorParameters=[],StoreUndoModule}();exports.UNDO_DEVTOOLS_CONFIG=UNDO_DEVTOOLS_CONFIG,exports.UNDO_ACTION=UNDO_ACTION,exports.StoreUndoModule=StoreUndoModule,Object.defineProperty(exports,"__esModule",{value:!0})});